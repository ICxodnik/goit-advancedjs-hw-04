{"version":3,"file":"commonHelpers.js","sources":["../src/serviceApi.js","../src/script.js"],"sourcesContent":["import axios from \"axios\";\n\nconst perPage = 40;\nconst imgFetcher = axios.create({\n    baseURL: 'https://pixabay.com/api/',\n    params: {\n        key: \"42411336-47edecd0595d1c6e33b2e7e0d\",\n        safesearch: true,\n        orientation: \"horizontal\",\n        image_type: \"photo\",\n        per_page: perPage,\n    }\n});\n\nexport async function getItems(searchValue, page = 1) {\n    const response = await imgFetcher.get('/', {\n        params: {\n            q: searchValue,\n            page,\n        }\n    });\n\n    const data = response.data.hits.map(element => {\n        return {\n            previewImageUrl: element.webformatURL,\n            largeImageUrl: element.largeImageURL,\n            altTags: element.tags,\n            likeCount: element.likes,\n            viewCount: element.views,\n            commentsCount: element.comments,\n            downloadCount: element.downloads,\n        }\n    });\n\n    return {\n        data,\n        /**\n         * `totalHits` field appears to be restricted to 500 items \n         * which is upper limit of a `per_page`\n         * so we use `total` to display all available images count\n         */\n        total: response.data.total,\n        hasNextPage: (response.data.total - (page * perPage)) > 0\n    };\n}\n","import * as serviceApi from \"./serviceApi\";\nimport iziToast from \"izitoast\";\nimport SimpleLightbox from \"simplelightbox\";\n\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst formRef = document.getElementById(\"search-form\");\nconst galleryRef = document.getElementById(\"gallery\");\nconst loadMoreRef = document.getElementById(\"load-more\");\nconst lightbox = new SimpleLightbox('.gallery a', {\n    captions: true,\n    captionDelay: 250,\n    captionType: 'attr',\n    captionsData: 'alt'\n});\n\nlet page = 1;\n\nformRef.addEventListener(\"submit\", async function onSubmit(e) {\n    e.preventDefault();\n    page = 1;\n    loadImages(formRef.elements.searchQuery.value, page);\n});\n\nloadMoreRef.addEventListener(\"click\", async function onLoadMore(e) {\n    page++;\n    loadImages(formRef.elements.searchQuery.value, page);\n});\n\nfunction clearGallary() {\n    galleryRef.innerHTML = \"\";\n}\n\nfunction addGallary(data) {\n    // TODO: change template instantiation to prevent XSS injection\n    const result = data.map(el => {\n        return `<div class=\"photo-card\">\n            <a class=\"gallery__link\" href=\"${el.largeImageUrl}\">\n                <img\n                    src=\"${el.previewImageUrl}\"\n                    alt=\"${el.altTags}\"\n                    data-source=\"${el.largeImageUrl}\"\n                    loading=\"lazy\"\n                    class=\"gallery__image\"\n                />\n            </a>\n            <div class=\"info\">\n                <p class=\"info-item\">\n                    <b>Likes</b>\n                    <span>${el.likeCount}</span>\n                </p>\n                <p class=\"info-item\">\n                    <b>Views</b>\n                    <span>${el.viewCount}</span>\n                </p>\n                <p class=\"info-item\">\n                    <b>Comments</b>\n                    <span>${el.commentsCount}</span>\n                </p>\n                <p class=\"info-item\">\n                    <b>Downloads</b>\n                    <span>${el.downloadCount}</span>\n                </p>\n            </div>\n        </div>`\n    })\n        .join(\"\");\n    galleryRef.insertAdjacentHTML(\"beforeend\", result);\n}\n\nconst NoImageFirstPage = \"Sorry, there are no images matching your search query.Please try again.\";\nconst NoImageLaterPages = \"We're sorry, but you've reached the end of search results.\";\n\nasync function loadImages(search, page) {\n    try {\n        loadMoreRef.classList.add(\"hidden\");\n\n        const result = await serviceApi.getItems(search, page);\n\n        const isFirstPage = page === 1;\n        const isLastPage = !result.hasNextPage;\n\n        if (!result.data.length) {\n            clearGallary();\n            iziToast.warning({\n                title: \"Caution\",\n                message: isFirstPage ? NoImageFirstPage : NoImageLaterPages,\n            });\n            return;\n        }\n\n        if (isFirstPage) {\n            clearGallary();\n\n            iziToast.success({\n                title: 'OK',\n                message: `Hooray! We found ${result.total} images.`,\n            });\n        }\n\n        addGallary(result.data);\n        lightbox.refresh();\n\n        if (!isFirstPage) {\n            scrollForward();\n        }\n        if (!isLastPage) {\n            loadMoreRef.classList.remove(\"hidden\");\n        }\n    }\n    catch (e) {\n        iziToast.error({\n            title: 'Error',\n            message: e.message,\n        });\n        console.log(e);\n    }\n}\n\nfunction scrollForward() {\n    const { height: cardHeight } = galleryRef.firstElementChild.getBoundingClientRect();\n\n    window.scrollBy({\n        top: cardHeight * 2,\n        behavior: \"smooth\",\n    });\n}\n\n"],"names":["perPage","imgFetcher","axios","getItems","searchValue","page","response","element","formRef","galleryRef","loadMoreRef","lightbox","SimpleLightbox","e","loadImages","clearGallary","addGallary","data","result","el","NoImageFirstPage","NoImageLaterPages","search","serviceApi.getItems","isFirstPage","isLastPage","iziToast","scrollForward","cardHeight"],"mappings":"owBAEA,MAAMA,EAAU,GACVC,EAAaC,EAAM,OAAO,CAC5B,QAAS,2BACT,OAAQ,CACJ,IAAK,qCACL,WAAY,GACZ,YAAa,aACb,WAAY,QACZ,SAAUF,CACb,CACL,CAAC,EAEM,eAAeG,EAASC,EAAaC,EAAO,EAAG,CAClD,MAAMC,EAAW,MAAML,EAAW,IAAI,IAAK,CACvC,OAAQ,CACJ,EAAGG,EACH,KAAAC,CACH,CACT,CAAK,EAcD,MAAO,CACH,KAbSC,EAAS,KAAK,KAAK,IAAIC,IACzB,CACH,gBAAiBA,EAAQ,aACzB,cAAeA,EAAQ,cACvB,QAASA,EAAQ,KACjB,UAAWA,EAAQ,MACnB,UAAWA,EAAQ,MACnB,cAAeA,EAAQ,SACvB,cAAeA,EAAQ,SAC1B,EACJ,EASG,MAAOD,EAAS,KAAK,MACrB,YAAcA,EAAS,KAAK,MAASD,EAAOL,EAAY,CAChE,CACA,CCrCA,MAAMQ,EAAU,SAAS,eAAe,aAAa,EAC/CC,EAAa,SAAS,eAAe,SAAS,EAC9CC,EAAc,SAAS,eAAe,WAAW,EACjDC,EAAW,IAAIC,EAAe,aAAc,CAC9C,SAAU,GACV,aAAc,IACd,YAAa,OACb,aAAc,KAClB,CAAC,EAED,IAAIP,EAAO,EAEXG,EAAQ,iBAAiB,SAAU,eAAwBK,EAAG,CAC1DA,EAAE,eAAc,EAChBR,EAAO,EACPS,EAAWN,EAAQ,SAAS,YAAY,MAAOH,CAAI,CACvD,CAAC,EAEDK,EAAY,iBAAiB,QAAS,eAA0BG,EAAG,CAC/DR,IACAS,EAAWN,EAAQ,SAAS,YAAY,MAAOH,CAAI,CACvD,CAAC,EAED,SAASU,GAAe,CACpBN,EAAW,UAAY,EAC3B,CAEA,SAASO,EAAWC,EAAM,CAEtB,MAAMC,EAASD,EAAK,IAAIE,GACb;AAAA,6CAC8BA,EAAG,aAAa;AAAA;AAAA,2BAElCA,EAAG,eAAe;AAAA,2BAClBA,EAAG,OAAO;AAAA,mCACFA,EAAG,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAQvBA,EAAG,SAAS;AAAA;AAAA;AAAA;AAAA,4BAIZA,EAAG,SAAS;AAAA;AAAA;AAAA;AAAA,4BAIZA,EAAG,aAAa;AAAA;AAAA;AAAA;AAAA,4BAIhBA,EAAG,aAAa;AAAA;AAAA;AAAA,eAIvC,EACI,KAAK,EAAE,EACZV,EAAW,mBAAmB,YAAaS,CAAM,CACrD,CAEA,MAAME,EAAmB,0EACnBC,EAAoB,6DAE1B,eAAeP,EAAWQ,EAAQjB,EAAM,CACpC,GAAI,CACAK,EAAY,UAAU,IAAI,QAAQ,EAElC,MAAMQ,EAAS,MAAMK,EAAoBD,EAAQjB,CAAI,EAE/CmB,EAAcnB,IAAS,EACvBoB,EAAa,CAACP,EAAO,YAE3B,GAAI,CAACA,EAAO,KAAK,OAAQ,CACrBH,IACAW,EAAS,QAAQ,CACb,MAAO,UACP,QAASF,EAAcJ,EAAmBC,CAC1D,CAAa,EACD,MACH,CAEGG,IACAT,IAEAW,EAAS,QAAQ,CACb,MAAO,KACP,QAAS,oBAAoBR,EAAO,KAAK,UACzD,CAAa,GAGLF,EAAWE,EAAO,IAAI,EACtBP,EAAS,QAAO,EAEXa,GACDG,IAECF,GACDf,EAAY,UAAU,OAAO,QAAQ,CAE5C,OACMG,EAAG,CACNa,EAAS,MAAM,CACX,MAAO,QACP,QAASb,EAAE,OACvB,CAAS,EACD,QAAQ,IAAIA,CAAC,CAChB,CACL,CAEA,SAASc,GAAgB,CACrB,KAAM,CAAE,OAAQC,CAAU,EAAKnB,EAAW,kBAAkB,wBAE5D,OAAO,SAAS,CACZ,IAAKmB,EAAa,EAClB,SAAU,QAClB,CAAK,CACL"}